pGenerated by [Clearly Reader](https://clearlyreader.com)

MySQLä¸‰å¤§æ—¥å¿—(binlog,redolog,undolog)è¯¦è§£ - æ˜é‡‘

é¢„è®¡æ—¶é—´ 15:31 å­—æ•° 3258 è¯­è¨€ ZH

ç”± OpenAI æä¾›æŠ€æœ¯æ”¯æŒ

è‡ªåŠ¨å¼€å¯ off

*   off
*   (this site)
*   (this site)/post

*   MySQLä¸‰å¤§æ—¥å¿—(binlog,redolog,undolog)è¯¦è§£ - æ˜é‡‘
*   ä¸€ã€MySQLæ—¥å¿—
*   äºŒã€redo log
*   åˆ·ç›˜æ—¶æœº
*   innodb\_flush\_log\_at\_trx\_commit = 0
*   innodb\_flush\_log\_at\_trx\_commit = 1
*   innodb\_flush\_log\_at\_trx\_commit = 2
*   æ—¥å¿—æ–‡ä»¶ç»„
*   redo logå°ç»“
*   ä¸‰ã€binlog
*   binlogæ—¥å¿—çš„ä½œç”¨
*   è®°å½•æ ¼å¼
*   å†™å…¥æœºåˆ¶
*   ä¸¤é˜¶æ®µæäº¤
*   undo log
*   æ€»ç»“

##### é“¾æ¥

*   [javaguide.cn/database/myâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fjavaguide.cn%2Fdatabase%2Fmysql%2Fmysql-logs.html)

##### æ ‡è®°

[æ™´å¤©çš„ç©ºé—´](https://juejin.cn/user/2911973447579854/posts)

2022-04-25 21:21 2033

> çƒ­è¡·å­¦ä¹ ï¼Œçƒ­è¡·ç”Ÿæ´»ï¼ğŸ˜„
> 
> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

### ä¸€ã€MySQLæ—¥å¿—

`MySQL`æ—¥å¿—ä¸»è¦åŒ…æ‹¬é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äº‹åŠ¡æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—å‡ å¤§ç±»ã€‚å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å°±æ˜¯äºŒè¿›åˆ¶æ—¥å¿—`binlog`ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€äº‹åŠ¡æ—¥å¿—`redo log`ï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œ`undo log`ï¼ˆå›æ»šæ—¥å¿—ï¼‰ã€‚

æ—¥å¿—å…³ç³»å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bab4fae8b1194cd9b1374e93d71f3437~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### äºŒã€redo log

`redo log`ï¼ˆé‡åšæ—¥å¿—ï¼‰æ˜¯`InnoDB`å­˜å‚¨å¼•æ“ç‹¬æœ‰çš„ï¼Œå®ƒè®©`MySQL`æœ‰äº†å´©æºƒæ¢å¤çš„èƒ½åŠ›ã€‚

å½“`MySQL`å®ä¾‹æŒ‚äº†æˆ–è€…å®•æœºäº†ï¼Œé‡å¯çš„æ—¶å€™`InnoDB`å­˜å‚¨å¼•æ“ä¼šä½¿ç”¨`rede log`æ—¥å¿—æ¢å¤æ•°æ®ï¼Œä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§å’Œå®Œæ•´æ€§ã€‚å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66d97496d7044415a0a4e8d47f1f0e92~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

`MySQL`ä¸­æ•°æ®æ˜¯ä»¥é¡µä¸ºå•æ•°å­˜å‚¨ï¼Œå½“ä½ æŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼Œç¡¬ç›˜ä¼šæŠŠä¸€æ•´é¡µçš„æ•°æ®åŠ è½½å‡ºæ¥ï¼ŒåŠ è½½å‡ºæ¥çš„æ•°æ®å«åšæ•°æ®é¡µï¼Œä¼šæ”¾åˆ°`Buffer Pool`ä¸­ã€‚åç»­çš„æŸ¥è¯¢éƒ½æ˜¯å…ˆä»`Buffer Pool`ä¸­æ‰¾ï¼Œæ²¡æœ‰æ‰¾åˆ°å†å»ç¡¬ç›˜åŠ è½½å…¶ä»–çš„æ•°æ®é¡µç›´åˆ°å‘½ä¸­ï¼Œè¿™æ ·å­å¯ä»¥å‡å°‘ç£ç›˜`IO`çš„æ¬¡æ•°ï¼Œæé«˜æ€§èƒ½ã€‚æ›´æ–°æ•°æ®çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¼˜å…ˆå»`Buffer Pool`ä¸­æ‰¾

ï¼Œå¦‚æœå­˜åœ¨éœ€è¦æ›´æ–°çš„æ•°æ®å°±ç›´æ¥æ›´æ–°ã€‚ç„¶åä¼šæŠŠâ€œåœ¨æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹â€è®°å½•åˆ°é‡åšæ—¥å¿—ç¼“å­˜ï¼ˆ`redo log buffer`ï¼‰é‡Œï¼Œåœ¨åˆ·ç›˜çš„æ—¶å€™ä¼šå†™å…¥`redo log`æ—¥å¿—æ–‡ä»¶é‡Œã€‚

å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05075b0f05e2433db19c9041cda963f6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

> å°è´´å£«ï¼šæ¯æ¡redoè®°å½•ç”±â€œè¡¨ç©ºé—´å·+æ•°æ®é¡µå·+åç§»é‡+ä¿®æ”¹æ•°æ®é•¿åº¦+å…·ä½“ä¿®æ”¹çš„æ•°æ®â€ç»„æˆã€‚

#### åˆ·ç›˜æ—¶æœº

ç†æƒ³æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸€æäº¤å°±ä¼šè¿›è¡Œåˆ·ç›˜æ“ä½œï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯åˆ·ç›˜çš„æ—¶æœºæ˜¯æ ¹æ®ç­–ç•¥æ¥å†³å®šçš„ã€‚

`InnoDB`å­˜å‚¨å¼•æ“ä¸º`redo log`çš„åˆ·ç›˜ç­–ç•¥æä¾›äº†`innodb_flush_log_at_trx_commit`å‚æ•°ï¼Œå®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š

*   0ï¼šè®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œæ¯æ¬¡æäº¤äº‹åŠ¡æ—¶ä¸åˆ·ç›˜ã€‚
*   1ï¼šè®¾ç½®ä¸º1çš„æ—¶å€™ï¼Œæ¯æ¬¡æäº¤äº‹åŠ¡æ—¶åˆ·ç›˜ã€‚
*   2ï¼šè®¾ç½®ä¸º2çš„æ—¶å€™ï¼Œæ¯æ¬¡æäº¤äº‹åŠ¡æ—¶éƒ½åªæŠŠ`redo log buffer`å†™å…¥`page cache`ã€‚

`innodb_flush_log_at_trx_commit`å‚æ•°é»˜è®¤ä¸º1ï¼Œå½“äº‹åŠ¡æäº¤çš„æ—¶å€™ä¼šè°ƒç”¨`fsync`å¯¹`redo log`è¿›è¡Œåˆ·ç›˜ï¼Œå°†`redo log buffer`å†™å…¥`redo log`æ–‡ä»¶ä¸­ã€‚

å¦å¤–ï¼Œ`Innodb`å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”`1`ç§’ï¼Œå°±ä¼šæŠŠä¼š`redo log buffer`ä¸­çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜`page cache`ï¼Œç„¶åè°ƒç”¨`fsync`åˆ·ç›˜ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2248ea3583ab45cf839a99f47deee5d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å¦‚ä¸Šå›¾ï¼Œæ‰€ä»¥è¯´ä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„`redo log`è®°å½•ï¼Œä¹Ÿä¼šè¢«åˆ·ç›˜ã€‚

ä¸‹é¢æ˜¯å„ç§åˆ·ç›˜ç­–ç•¥çš„æµç¨‹å›¾ã€‚

##### innodb\_flush\_log\_at\_trx\_commit = 0

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed1b76d46b774829aaff68728e660b67~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å¦‚ä¸Šå›¾ï¼Œå¦‚æœå®•æœºäº†æˆ–è€…`MySQL`æŒ‚äº†å¯èƒ½é€ æˆ`1`ç§’å†…çš„æ•°æ®ä¸¢å¤±ã€‚

##### innodb\_flush\_log\_at\_trx\_commit = 1

å¦‚ä¸Šå›¾ï¼Œåªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œ`redo log`è®°å½•å°±ä¸€å®šåœ¨ç£ç›˜é‡Œï¼Œä¸ä¼šæœ‰ä»»åŠ¡æ•°æ®ä¸¢å¤±ã€‚

å¦‚æœæ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™`MySQL`æŒ‚äº†æˆ–è€…å®•æœºäº†ï¼Œè¿™éƒ¨åˆ†æ—¥å¿—ä¸¢å¤±äº†ï¼Œä½†æ˜¯å› ä¸ºäº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3b6abd7151f46b7b4ffb491db3d66ee~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

##### innodb\_flush\_log\_at\_trx\_commit = 2

å¦‚ä¸Šå›¾ï¼Œå½“äº‹åŠ¡æäº¤æˆåŠŸæ—¶ï¼Œ`redo log buffer`æ—¥å¿—ä¼šè¢«å†™å…¥`page cache`ï¼Œç„¶ååå°çº¿ç¨‹ä¼šåˆ·ç›˜å†™å…¥`redo log`ï¼Œç”±äºåå°çº¿ç¨‹æ˜¯`1`ç§’æ‰§è¡Œä¸€æ¬¡æ‰€ä»¥å®•æœºæˆ–è€…`MySQL`æŒ‚äº†å¯èƒ½é€ æˆ`1`ç§’å†…çš„æ•°æ®ä¸¢å¤±ã€‚

#### æ—¥å¿—æ–‡ä»¶ç»„

ç¡¬ç›˜ä¸Šå­˜å‚¨çš„`redo log`æ—¥å¿—æ–‡ä»¶ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯ä¸€ä¸ª**æ—¥å¿—æ–‡ä»¶ç»„**çš„å½¢å¼å‡ºç°çš„ï¼Œæ¯ä¸ªçš„`redo log`æ–‡ä»¶å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ã€‚å®ƒé‡‡ç”¨çš„æ˜¯ç¯å½¢æ•°ç»„å½¢å¼ï¼Œä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å›åˆ°å¤´å¾ªç¯å†™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb481cbf4c794d6f99c937edf3433c74~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

åœ¨**æ—¥å¿—æ–‡ä»¶ç»„**ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯`witre posã€checkpoint`

*   **wirte pos**ï¼šæ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»ã€‚
*   **checkpoint**ï¼šæ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯åå°æ¨ç§»ã€‚

æ¯æ¬¡åˆ·ç›˜`redo log`è®°å½•åˆ°**æ—¥å¿—æ–‡ä»¶ç»„**ä¸­ï¼Œ`wirte log`ä½ç½®å°±ä¼šåç§»æ›´æ–°ã€‚

æ¯æ¬¡`MySQL`åŠ è½½**æ—¥å¿—æ–‡ä»¶ç»„**æ¢å¤æ•°æ®æ—¶ï¼Œä¼šæ¸…ç©ºåŠ è½½è¿‡çš„`redo log`ï¼Œå¹¶æŠŠ`checkpoint`åç§»æ›´æ–°ã€‚

`write pos` å’Œ `checkpoint` ä¹‹é—´çš„è¿˜ç©ºç€çš„éƒ¨åˆ†å¯ä»¥ç”¨æ¥å†™å…¥æ–°çš„ `redo log` è®°å½•ã€‚

å¦‚æœ `witre pos`è¿½ä¸Š`checkpoint`ï¼Œè¡¨ç¤º**æ—¥å¿—æ–‡ä»¶ç»„**æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†å†™å…¥æ–°çš„`redo log`è®°å½•ï¼Œ`MySQL`å¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•ï¼ŒæŠŠ`checkpoint`æ¨èä¸€ä¸‹ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d07fd729b0bd44c1ae8be8619c6a6131~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

#### redo logå°ç»“

`redo log`çš„ä½œç”¨å’Œå®ƒçš„åˆ·ç›˜æ—¶æœºã€å­˜å‚¨å½¢å¼ã€‚

å¯ä»¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š**åªè¦æ¯æ¬¡æŠŠä¿®æ”¹åçš„æ•°æ®é¡µç›´æ¥åˆ·ç›˜ä¸å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨`redo log`åˆ·ç›˜ï¼Ÿä¸éƒ½æ˜¯åˆ·ç›˜å—ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

å®é™…ä¸Šï¼Œæ•°æ®é¡µå¤§å°æ˜¯`16KB`ï¼Œåˆ·ç›˜æ¯”è¾ƒè€—æ—¶ï¼Œå¯èƒ½å°±ä¿®æ”¹äº†æ•°æ®é¡µçš„å‡ `byte`æ•°æ®ï¼Œæ²¡æœ‰å¿…è¦æŠŠæ•´é¡µçš„æ•°æ®åˆ·ç›˜ã€‚è€Œä¸”æ•°æ®é¡µåˆ·ç›˜éƒ½æ˜¯éšæœºå†™ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®é¡µå¯¹åº”çš„ä½ç½®å¯èƒ½æ˜¯åœ¨ç¡¬ç›˜æ–‡ä»¶çš„éšæœºä½ç½®ï¼Œæ‰€ä»¥æ€§èƒ½å¾ˆå·®ã€‚

å¦‚æœæ˜¯å†™`redo log`ï¼Œä¸€è¡Œè®°å½•å°±å äº†å‡ å`byte`ï¼Œåªè¦åŒ…å«äº†è¡¨ç©ºé—´å·ã€æ•°æ®é¡µå·ã€ç£ç›˜æ–‡ä»¶åç§»é‡ã€ä¿®æ”¹å€¼ï¼Œå†åŠ ä¸Šæ˜¯é¡ºåºå†™ï¼Œæ‰€ä»¥åˆ·ç›˜æ•ˆç‡å¾ˆé«˜ã€‚

æ‰€ä»¥ç”¨ `redo log` å½¢å¼è®°å½•ä¿®æ”¹å†…å®¹ï¼Œæ€§èƒ½ä¼šè¿œè¿œè¶…è¿‡åˆ·æ•°æ®é¡µçš„æ–¹å¼ï¼Œè¿™ä¹Ÿè®©æ•°æ®åº“çš„å¹¶å‘èƒ½åŠ›æ›´å¼ºã€‚

### ä¸‰ã€binlog

`redo log`æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº`Innodb`å­˜å‚¨å¼•æ“ã€‚

è€Œ`binlog`æ—¥å¿—æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œå±äº`MySQL Server`å±‚ã€‚æ‰€æœ‰çš„å­˜å‚¨å¼•æ“åªè¦å‘ç”Ÿäº†æ•°æ®æ›´æ–°ï¼Œéƒ½ä¼šäº§ç”Ÿ`binlog`æ—¥å¿—ã€‚

#### `binlog`æ—¥å¿—çš„ä½œç”¨

å¯ä»¥è¯´`MySQL`æ•°æ®åº“çš„**æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä½ä»**éƒ½ç¦»ä¸å¼€`binlog`ï¼Œéœ€è¦ä¾èµ–`binlog`æ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f3a6a961cdb4096b9894f56b2d70a19~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

`binlog`ä¼šè®°å½•æ‰€æœ‰æ¶‰åŠæ›´æ–°æ•°æ®çš„é€»è¾‘è§„åˆ™ï¼Œå¹¶ä¸”æŒ‰é¡ºåºå†™ã€‚

#### è®°å½•æ ¼å¼

`binlog`æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡`binlog_format`å‚æ•°è®¾ç½®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ï¼š

*   **statement**
*   **row**
*   **mixed**

è®¾ç½®`statement`è®°å½•çš„å†…å®¹æ˜¯`SQL`è¯­å¥åŸæ–‡ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€æ¡`update T set update_time = now() where id = 1`ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹ï¼š ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f35bf260283c428d8d576220f6571429~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

åŒæ­¥æ•°æ®æ—¶ï¼Œä¼šæ‰§è¡Œè®°å½•çš„`SQL`è¯­å¥ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜`update_time = now()`è¿™é‡Œä¼šè·å–åˆ°å½“å‰ç³»ç»Ÿé—®é¢˜ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“æ•°æ®ä¸ä¸€è‡´ã€‚

ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å°†`binlog_format`è®¾ç½®æˆ`row`ï¼Œè®°å½•çš„ä¸å†æ˜¯ç®€å•çš„`SQL`è¯­å¥äº†ï¼Œè¿˜åŒ…å«äº†æ“ä½œçš„å…·ä½“æ•°æ®ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07157922942a4494bde44cd1bc872b0c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

`row`æ ¼å¼è®°å½•çš„å†…å®¹çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œé€šè¿‡`mysqlbinlog`å·¥å…·è§£æå‡ºæ¥ã€‚

`update_time = now()`å˜æˆäº†å…·ä½“çš„æ—¶é—´ï¼Œæ¡ä»¶åé¢çš„`@1ã€@2`éƒ½æ˜¯è¯¥è¡Œæ•°æ®ç¬¬1ä¸ª~2ä¸ªå­—æ®µçš„åŸå§‹å€¼ï¼ˆå‡è®¾è¿™å¼ è¡¨åªæœ‰2ä¸ªå­—æ®µï¼‰ã€‚

è®¾ç½®æˆ`row`å¸¦æ¥çš„å¥½å¤„å°±æ˜¯åŒæ­¥æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸æƒ…å†µéƒ½è®¾ç½®æˆ`row`ï¼Œè¿™æ ·å¯ä»¥ä¸ºæ•°æ®åº“çš„æ¢å¤ä¸åŒæ­¥å¸¦æ¥æ›´å¥½çš„å¯é æ€§ã€‚ä½†æ˜¯è¿™ç§æ ¼å¼éœ€è¦å¤§é‡çš„å®¹é‡æ¥è®°å½•ï¼Œæ¯”è¾ƒå ç”¨ç©ºé—´ï¼Œæ¢å¤ä¸åŒæ­¥æ—¶ä¼šæ›´æ¶ˆè€—`IO`èµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚

æ‰€ä»¥åˆæœ‰äº†ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆï¼Œè®¾ç½®ä¸º`mixed`ï¼Œè®°å½•çš„å†…å®¹æ˜¯å‰ä¸¤è€…çš„æ··åˆã€‚

`MySQL`ä¼šåˆ¤æ–­è¿™æ¡`SQL`è¯­å¥æ˜¯å¦ä¼šå¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯å°±ç”¨`row`æ ¼å¼ï¼Œå¦åˆ™å°±ç”¨`statement`æ ¼å¼ã€‚

#### å†™å…¥æœºåˆ¶

`binlog`çš„å†™å…¥æ—¶æœºä¸ºäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°`binlog cache`ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™å†æŠŠ`binlog cache`å†™åˆ°`binlog`æ–‡ä»¶ä¸­ï¼ˆå®é™…å…ˆä¼šå†™å…¥`page cache`ï¼Œç„¶åå†ç”±`fsync`å†™å…¥`binlog`æ–‡ä»¶ï¼‰ã€‚

å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„`binlog`ä¸èƒ½è¢«æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ä½œä¸º`binlog cache`ã€‚å¯ä»¥é€šè¿‡`binlog_cache_size`å‚æ•°æ§åˆ¶å•çº¿ç¨‹`binlog_cache`å¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚

`binlog`æ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹ï¼š

*   **ä¸Šå›¾çš„`write`ï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„`page cache`ï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–ç¡¬ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚**
*   **ä¸Šå›¾çš„ `fsync`æ‰æ˜¯å°†æ•°æ®åº“æŒä¹…åŒ–åˆ°ç¡¬ç›˜çš„æ“ä½œã€‚**

`write`å’Œ`fsync`çš„æ—¶æœºå¯ä»¥ç”±å‚æ•°`sync_binlog`æ§åˆ¶ï¼Œå¯ä»¥é…ç½®æˆ`0ã€1ã€N(N>1)`ã€‚

*   è®¾ç½®æˆ0æ—¶ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªä¼š`write`ï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ`fsync`ã€‚
*   è®¾ç½®æˆ1æ—¶ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ`fsync`ï¼Œå°±å’Œ`redo log`æ—¥å¿—åˆ·ç›˜æµç¨‹ä¸€æ ·ã€‚
*   è®¾ç½®æˆNæ—¶ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼š`write`ï¼Œä½†æ˜¯ç§¯ç´¯`N`ä¸ªäº‹åŠ¡åæ‰`fsync`ã€‚

è®¾ç½®ä¸º0æ—¶å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cba9aa9e1554dcfb80f9fae9b6ce680~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

ä»ä¸Šå›¾å¯çŸ¥ï¼Œ`sync_bilog = 0`è®¾ç½®æˆ`0`ï¼ŒåªæŠŠæ—¥å¿—å†™å…¥`page cache`è™½ç„¶æ€§èƒ½å¾—åˆ°äº†æé«˜ï¼Œä½†æ˜¯äº‹åŠ¡æäº¤äº†`fsync`çš„æ—¶å€™å®•æœºäº†ï¼Œå¯èƒ½é€ æˆ`binlog`æ—¥å¿—çš„ä¸¢å¤±ã€‚

è®¾ç½®ä¸º2æ—¶å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab3644565e2041668cb164574fd004de~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

åœ¨å‡ºç°`IO`ç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†`sync_binlog`è®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚

åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘`N`ä¸ªäº‹åŠ¡çš„`binlog`æ—¥å¿—ã€‚

### ä¸¤é˜¶æ®µæäº¤

`redo log`ï¼ˆé‡åšæ—¥å¿—ï¼‰è®©`InnoDB`å­˜å‚¨å¼•æ“æœ‰äº†å´©æºƒæ¢å¤çš„èƒ½åŠ›ã€‚

`binlog`ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ä¿è¯äº†`MySQL`é›†ç¾¤æ¶æ„æ•°æ®çš„ä¸€è‡´æ€§ã€‚

è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸ä¸€æ ·ã€‚

åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•`redo log`ä¸`binlog`ä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œ`redo log`åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œ`binlog`æ—¥å¿—åªæœ‰åœ¨æäº¤äº‹åŠ¡çš„æ—¶å€™æ‰ä¼šå†™å…¥ï¼Œæ‰€ä»¥å®ƒä»¬å†™å…¥çš„æ—¶æœºä¸ä¸€æ ·ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67badee893d14838b48277a41ae37923~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

> æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœredo logå’Œbinlogä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€æ ·ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼ŸMySQLæ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ

æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå‡è®¾æœ‰è¿™ä¹ˆä¸€æ¡è¯­å¥`update T set c = 1 where id = 2`ï¼ˆcåŸå€¼ä¸º0ï¼‰ï¼Œå‡å¦‚æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å®Œ`redo log`æ—¥å¿—åï¼Œåœ¨å†™å…¥`binlog`çš„æ—¶å€™å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ

å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a6210bef809643589593df1f82023bbc~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

ç”±äº`binlog`æ—¥å¿—æ²¡å†™å®Œå°±å¼‚å¸¸ï¼Œè¿™ä¸ªæ—¶å€™`binlog`æ—¥å¿—é‡Œé¢æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹è®°å½•ï¼Œä¹‹åä½¿ç”¨`binlog`åŒæ­¥çš„æ•°æ®çš„æ—¶å€™å°±ä¼šå°‘è¿™ä¸€æ¬¡çš„æ›´æ–°ï¼Œè¿™ä¸€è¡Œæ•°æ®`c = 0`ï¼Œè€ŒåŸåº“ä½¿ç”¨`redo log`æ—¥å¿—æ¢å¤ï¼Œè¿™ä¸€è¡Œæ•°æ®`c = 1` ï¼Œæœ€ç»ˆæ•°æ®ä¸ä¸€è‡´ã€‚å¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5c794f1956943d19e2d937644626516~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

ä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ`InnoDB`å­˜å‚¨å¼•æ“ä½¿ç”¨**ä¸¤é˜¶æ®µæäº¤**æ–¹æ¡ˆã€‚

å°†`redo log`æ—¥å¿—çš„å†™å…¥æ‹†åˆ†æˆä¸¤ä¸ªæ­¥éª¤`prepare`å’Œ`commit`ï¼Œå¦‚ä¸‹å›¾ï¼š

ä½¿ç”¨**ä¸¤é˜¶æ®µæäº¤**åï¼Œå†™å…¥`binlog`æ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸º`MySQL`æ ¹æ®`redo log`æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç°`redo log`æ—¥å¿—å¤„äº`prepare`é˜¶æ®µï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”`binlog`æ—¥å¿—ï¼ˆæ ¹æ®äº‹åŠ¡idå¯¹åº”ï¼‰ï¼Œæ‰€ä»¥å°±ä¼šå›æ»šäº‹åŠ¡ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dca5a873e3ff4fcbafb82044eccfcbe6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å†æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œ`redo lgo`è®¾ç½®`commit`é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šä¸ä¼šå›æ»šå‘¢ï¼Ÿ

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9cb4826b521e4f018713e2f1fbfaca08~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œè™½ç„¶`redo log`æ˜¯å¤„äº`prepare`é˜¶æ®µï¼Œä½†æ˜¯å­˜åœ¨å¯¹åº”çš„äº‹åŠ¡`binlog`æ—¥å¿—ï¼Œæ‰€ä»¥`MySQL`è®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œæ‰€ä»¥ä¸ä¼šå›æ»šäº‹åŠ¡ã€‚

### undo log

æƒ³è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œå›æ»šï¼Œåœ¨`MySQL`ä¸­æ¢å¤æœºåˆ¶æ˜¯é€šè¿‡`undo log`ï¼ˆå›æ»šæ—¥å¿—ï¼‰å®ç°çš„ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆè¢«è®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ï¼Œç„¶åå†æ‰§è¡Œå…¶ä»–ç›¸å…³çš„æ“ä½œã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å›æ»šæ—¥å¿—ä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­ã€‚å¹¶ä¸”ï¼Œå›æ»šæ—¥å¿—ä¼šå…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·å°±ä¿è¯äº†å³ä½¿é‡åˆ°æ•°æ®åº“çªç„¶å®•æœºç­‰æƒ…å†µï¼Œå½“ç”¨æˆ·å†æ¬¡å¯åŠ¨æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“è¿˜èƒ½å¤Ÿé€šè¿‡æŸ¥è¯¢å›æ»šæ—¥å¿—æ¥å›æ»šå°†ä¹‹å‰æœªå®Œæˆçš„äº‹åŠ¡ã€‚

å¦å¤–ï¼Œ`MVCC`çš„å®ç°ä¾èµ–ï¼š**éšè—å­—æ®µã€`Read View`ã€`undo log`**ã€‚åœ¨åº•å±‚å®ç°ä¸­ï¼Œ`InnoDB`é€šè¿‡æ•°æ®è¡Œçš„`DB_TRX_ID`å’Œ`Read View`æ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡æ•°æ®è¡Œ`DB_ROLL_PTR`æ‰¾åˆ°`undo log`ä¸­çš„å†å²ç‰ˆæœ¬ã€‚æ¯ä¸ªäº‹åŠ¡è¯»åˆ°çš„æ•°æ®ç‰ˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªäº‹ç‰©é‡Œï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯¥äº‹åŠ¡åˆ›å»º`Read View`ä¹‹å‰å·²ç»æäº¤çš„ä¿®æ”¹å’Œè¯¥äº‹åŠ¡æœ¬èº«åšçš„ä¿®æ”¹ã€‚

### æ€»ç»“

`MySQL InnoDB`å¼•æ“ä½¿ç”¨`redo log`æ—¥å¿—ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œä½¿ç”¨`undo log`æ—¥å¿—ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚

`MySQL`æ•°æ®åº“çš„**æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»**ç¦»ä¸å¼€`binlog`ï¼Œéœ€è¦ä¾èµ–`binlog`æ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚

> å‚è€ƒï¼š[javaguide.cn/database/myâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fjavaguide.cn%2Fdatabase%2Fmysql%2Fmysql-logs.html "https://javaguide.cn/database/mysql/mysql-logs.html")
